@model AspBlog.Models.PageContent
@{
    ViewData["Title"] = Model.Title;

}

<p>@Html.Raw(Model.Content)</p>

@if (Model.Pictures.Any())
{
    <h3>Fotky</h3>
    <div>
        @foreach (var pic in Model.Pictures)
        {
            <img src="@pic.FilePath" alt="Fotka" width="300" loading="lazy" />
        }
    </div>
}

@if (User.IsInRole(UserRoles.Admin))
{
    <h5>Přidat fotky:</h5>
    <form asp-controller="Pictures" asp-action="Upload" method="post" enctype="multipart/form-data">
        <input type="hidden" name="pageContentId" value="@Model.Id" />
        <input type="file" name="files" multiple />
        <button type="submit">Nahrát fotky</button>
    </form>
}

<h3>Komentáře</h3>

<div class="comment-section">
    @if (User.Identity.IsAuthenticated)
    {
        <div class="comment-form">
            <form asp-controller="Comments" asp-action="AddComment" method="post">
                <input type="hidden" name="newsId" value="@Model.Id" />
                <textarea name="content" required placeholder="Write a comment..."></textarea>
                <button type="submit">➕ Přidat komentář</button>
            </form>
        </div>
    }
    else
    {
        <p>Pro přidání komentáře musíte být přihlášeni.</p>
    }

    @if (Model.Commentars != null && Model.Commentars.Any())
    {
        @foreach (var comment in Model.Commentars.OrderByDescending(c => c.Date))
        {
            <div class="comment">
                <div class="comment-header">
                    @comment.UserName
                    <span class="comment-date">(@comment.Date.ToString("g"))</span>
                </div>
                <div class="comment-content">
                    @comment.Content
                </div>

                @if (User.Identity.IsAuthenticated && (User.Identity.Name == comment.UserName || User.IsInRole("Admin")))
                {
                    <div class="comment-actions">
                        <a asp-controller="Comments" asp-action="EditComment" asp-route-id="@comment.Id">✏️ Upravit</a>

                        <form asp-controller="Comments" asp-action="DeleteComment" method="post" style="display:inline;">
                            <input type="hidden" name="id" value="@comment.Id" />
                            <button type="submit" onclick="return confirm('Opravdu chcete tento komentář smazat?')">🗑️ Smazat</button>
                        </form>
                    </div>
                }
            </div>
        }
    }
    else
    {
        <p>Zatím žádné komentáře.</p>
    }
</div>



<p><a class="clanky-tlacitko" asp-action="News">Zpět na seznam</a></p>

