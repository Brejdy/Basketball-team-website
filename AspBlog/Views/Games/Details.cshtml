@model AspBlog.Models.Games
@{
    ViewData["Title"] = Model.Oponent;
}

<table>
    <tr>
        <th>Datum</th>
        <th>Nepřítel</th>
        <th>Skóre</th>
        <th>Místo</th>
    </tr>
    <tr>
        <td>@Model.DateOfGame</td>
        <td>@Model.Oponent</td>
        <td>@Model.Score</td>
        <td>@Model.Place</td>
    </tr>
</table>

<h3>Poznámka:</h3>
<p>@Html.Raw(Model.Describtion)</p>

<h3>Komentáře</h3>

<div class="comment-section">
    @if (User.Identity.IsAuthenticated)
    {
        <div class="comment-form">
            <form asp-controller="Comments" asp-action="AddComment" method="post">
                <input type="hidden" name="gamesId" value="@Model.Id" />
                <textarea name="content" required placeholder="Write a comment..."></textarea>
                <button type="submit">➕ Přidat komentář</button>
            </form>
        </div>
    }
    else
    {
        <p>Pro přidání komentáře musíte být přihlášeni.</p>
    }

    @if (Model.Commentars != null && Model.Commentars.Any())
    {
        @foreach (var comment in Model.Commentars.OrderByDescending(c => c.Date))
        {
            <div class="comment">
                <div class="comment-header">
                    @comment.UserName
                    <span class="comment-date">(@comment.Date.ToString("g"))</span>
                </div>
                <div class="comment-content">
                    @comment.Content
                </div>

                @if (User.Identity.IsAuthenticated && (User.Identity.Name == comment.UserName || User.IsInRole("Admin")))
                {
                    <div class="comment-actions">
                        <a asp-controller="Comments" asp-action="EditComment" asp-route-id="@comment.Id">✏️ Upravit</a>

                        <form asp-controller="Comments" asp-action="DeleteComment" method="post" style="display:inline;">
                            <input type="hidden" name="id" value="@comment.Id" />
                            <button type="submit" onclick="return confirm('Opravdu chcete tento komentář smazat?')">🗑️ Smazat</button>
                        </form>
                    </div>
                }
            </div>
        }
    }
    else
    {
        <p>Zatím žádné komentáře.</p>
    }
</div>

<p><a class="clanky-tlacitko" asp-action="Index">Zpět na seznam</a></p>

